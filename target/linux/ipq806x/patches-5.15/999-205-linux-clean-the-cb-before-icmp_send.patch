From b35a2636f9808a7610b6a72a6a81d1df37f79945 Mon Sep 17 00:00:00 2001
From: Ken Zhu <guigenz@codeaurora.org>
Date: Tue, 20 Mar 2018 12:18:01 -0700
Subject: [PATCH] linux: clean the cb before icmp_send

In the icmp_send function, skb->cb is used as ip_option, but it may be used
by other sub-systems before ipv4_link_failure.

So clean the skb->cb before entering icmp_send.

Change-Id: I985b363e7f1b00314843bcda1fa8b78bbc1bd7d8
Signed-off-by: Ken Zhu <guigenz@codeaurora.org>
---
 net/ipv4/route.c | 3 +++
 1 file changed, 3 insertions(+)

--- a/net/ipv4/route.c
+++ b/net/ipv4/route.c
@@ -1253,6 +1253,9 @@ static void ipv4_link_failure(struct sk_
 {
 	struct rtable *rt;
 
+	/* Forwarding packets, do not have IPCB() initialized, do so
+	 */
+	memset(IPCB(skb), 0, sizeof(struct inet_skb_parm));
 	ipv4_send_dest_unreach(skb);
 
 	rt = skb_rtable(skb);
