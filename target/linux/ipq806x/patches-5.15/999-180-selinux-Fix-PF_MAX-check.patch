From 213aab38358a7b6f8f5740f3e72790a5f0c13cf3 Mon Sep 17 00:00:00 2001
From: Himanshu Joshi <himajosh@codeaurora.org>
Date: Wed, 8 Sep 2021 16:17:26 +0530
Subject: [PATCH] [selinux] Fix PF_MAX check.

After adding AF_OVPN the PF_MAX count becomes 46.

Change-Id: I261af2d971a04be2867a3c64692f744bcba5809b
Signed-off-by: Himanshu Joshi <himajosh@codeaurora.org>
---
 security/selinux/hooks.c            | 4 +++-
 security/selinux/include/classmap.h | 4 +++-
 2 files changed, 6 insertions(+), 2 deletions(-)

--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@ -1329,7 +1329,9 @@ static inline u16 socket_type_to_securit
 			return SECCLASS_XDP_SOCKET;
 		case PF_MCTP:
 			return SECCLASS_MCTP_SOCKET;
-#if PF_MAX > 46
+		case PF_OVPN:
+			return SECCLASS_OVPN_SOCKET;
+#if PF_MAX > 47
 #error New address family defined, please update this function.
 #endif
 		}
--- a/security/selinux/include/classmap.h
+++ b/security/selinux/include/classmap.h
@@ -254,9 +254,11 @@ struct security_class_mapping secclass_m
 	  { "integrity", "confidentiality", NULL } },
 	{ "anon_inode",
 	  { COMMON_FILE_PERMS, NULL } },
+	{ "ovpn_socket",
+	  { COMMON_SOCK_PERMS, NULL } },
 	{ NULL }
   };
 
-#if PF_MAX > 46
+#if PF_MAX > 47
 #error New address family defined, please update secclass_map.
 #endif
